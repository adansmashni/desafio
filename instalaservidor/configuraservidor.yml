---
  - name: "Preparando o server"
    hosts: localhost
    connection: local

    tasks:
     
    - name: "Instala Pacotes Iniciais"
      yum:   
        name: "{{ item }}"
        state: present
      loop:
        - bash-completion
        - yum-utils
        - vim
        - bind-utils
        - net-tools
        - telnet
        - wget
        - curl
        - git
        - gcc-c++
        - make
        - automake
        - nginx
    
    - name: Template Vhost
      template:
        src: vhost.conf.j2
        dest: /etc/nginx/conf.d/vhost.conf
        owner: root
        group: root
        mode: '0644'

    - name: "Configura repo NodeJS"
      shell: "curl -sL https://rpm.nodesource.com/setup_12.x | sudo bash -"

    - name: "Instala NodeJs"
      yum:
        name: nodejs
        state: present

    - name: "Cria usuario node"
      user: 
        name: node
        comment: Node App user
        shell: /bin/bash
    
    - name: Template Deploy
      template:
        src: deploy.sh.j2
        dest: "{{ appdir }}/deploy.sh"
        owner: node
        group: node
        mode: '0744'